<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inicio</title>
    <link rel="stylesheet" href="Styles/index.css">
    <script src="JavaScript/script.js"></script>
    <link rel="icon" href="/Icons/icono-pavon-arriba.jpeg" type="image/png">
</head> 

<body>
    <!-- Barra de usuario en la esquina superior -->
    <div class="user-bar" id="userBar">
        <!-- Se genera dinámicamente con JavaScript -->
    </div>

    <div class="container fondo-principal">
        <div class="texto-rectangulo">
            <h1>AYUDANOS A AYUDARTE</h1>
            <p>Completá el formulario.</p>
            <div class="botones-principales">
                <a href="/Pages/formulario.html" class="btn btn-formulario">Ir al formulario</a>
                <!-- Botón de admin - se muestra solo si está logueado -->
                <a href="/admin.html" class="btn btn-admin" id="adminButton" style="display: none;">Panel de Administración</a>
            </div>
        </div>
    </div>

    <div class="mapa">
        <iframe
            src="https://www.google.com/maps/embed?pb=!4v1758942593134!6m8!1m7!1sqCdeLfTUwOiE7tc-c51Kkg!2m2!1d-33.31079468368811!2d-60.82702682233612!3f180.95817649506793!4f-3.6111578065198273!5f0.7820865974627469"
            allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade">
        </iframe>
    </div>

    <div class="logo-abajo">
        <img src="/Images/LOGO-BLANCO-PNG-RGB.webp" alt="Logo" class="icono-form">
    </div>

    <footer>
        &copy; Todos los derechos reservados.
    </footer>

    <!-- Modal de Login -->
    <div class="modal" id="loginModal" style="display: none;">
        <div class="modal-content">
            <span class="close" id="closeModal">&times;</span>
            <h2>Iniciar Sesión</h2>
            <form id="loginForm">
                <input type="text" id="username" placeholder="Usuario" required>
                <input type="password" id="password" placeholder="Contraseña" required>
                <button type="submit">Ingresar</button>
            </form>
            <div class="error-message" id="errorMessage" style="display: none;">
                Usuario o contraseña incorrectos
            </div>
            <!-- Ayuda para pruebas -->
            <div style="margin-top: 15px; padding: 10px; background: #f0f0f0; border-radius: 4px; font-size: 12px; color: #666;">
                <strong>Usuarios disponibles:</strong><br>
                <strong>Administradores:</strong> admin/cic2024 | administrador/pavon123<br>
                <strong>Operador:</strong> operador1/op123<br>
                <strong>Solo Lectura:</strong> consulta/read123
            </div>
        </div>
    </div>

    <script>
        // Base de datos completa de usuarios con roles
        const USERS_DATABASE = {
            'admin': { password: 'cic2024', role: 'admin', email: 'admin@cic.gob.ar' },
            'administrador': { password: 'pavon123', role: 'admin', email: 'admin2@cic.gob.ar' },
            'operador1': { password: 'op123', role: 'operador', email: 'operador@cic.gob.ar' },
            'consulta': { password: 'read123', role: 'lectura', email: 'consulta@cic.gob.ar' }
        };

        // Verificar estado de login al cargar la página
        document.addEventListener('DOMContentLoaded', function() {
            updateUIBasedOnAuth();
        });

        function updateUIBasedOnAuth() {
            const isLoggedIn = sessionStorage.getItem('isLoggedIn');
            const currentUser = sessionStorage.getItem('currentUser');
            const userRole = sessionStorage.getItem('userRole');
            const userBar = document.getElementById('userBar');
            const adminButton = document.getElementById('adminButton');

            if (isLoggedIn === 'true' && currentUser) {
                // Usuario logueado - mostrar info y logout
                userBar.innerHTML = `
                    <div class="user-info">
                        <span>${getRoleDisplay(userRole)}: ${currentUser}</span>
                        <button onclick="logout()" class="logout-btn">Cerrar Sesión</button>
                    </div>
                `;
                
                // Mostrar panel según el rol
                if (userRole === 'admin') {
                    adminButton.style.display = 'inline-block';
                    adminButton.textContent = 'Panel de Administración';
                } else if (userRole === 'operador') {
                    adminButton.style.display = 'inline-block';
                    adminButton.textContent = 'Panel de Datos';
                } else if (userRole === 'lectura') {
                    adminButton.style.display = 'inline-block';
                    adminButton.textContent = 'Ver Datos';
                } else {
                    adminButton.style.display = 'none';
                }
            } else {
                // Usuario no logueado - mostrar login
                userBar.innerHTML = `
                    <div class="login-info">
                        <button onclick="showLoginModal()" class="login-btn">Iniciar Sesión</button>
                    </div>
                `;
                adminButton.style.display = 'none';
            }
        }

        function getRoleDisplay(role) {
            const roles = {
                'admin': 'Admin',
                'operador': 'Operador',
                'lectura': 'Consulta'
            };
            return roles[role] || role;
        }

        function showLoginModal() {
            document.getElementById('loginModal').style.display = 'block';
            // Enfocar el campo de usuario
            setTimeout(() => {
                document.getElementById('username').focus();
            }, 100);
        }

        function hideLoginModal() {
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('loginForm').reset();
            document.getElementById('errorMessage').style.display = 'none';
        }

        function logout() {
            if (confirm('¿Desea cerrar la sesión?')) {
                sessionStorage.removeItem('isLoggedIn');
                sessionStorage.removeItem('currentUser');
                sessionStorage.removeItem('userRole');
                // Mantener compatibilidad con el sistema anterior
                sessionStorage.removeItem('isAdmin');
                sessionStorage.removeItem('adminUser');
                updateUIBasedOnAuth();
                alert('Sesión cerrada exitosamente');
            }
        }

        // Event listeners
        document.getElementById('closeModal').addEventListener('click', hideLoginModal);
        
        document.getElementById('loginModal').addEventListener('click', function(e) {
            if (e.target === this) hideLoginModal();
        });

        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const errorDiv = document.getElementById('errorMessage');
            
            console.log('Intentando login con:', username); // Para debug
            
            // Verificar credenciales en la base de datos
            const user = USERS_DATABASE[username];
            
            if (user && user.password === password) {
                // Login exitoso
                console.log('Login exitoso como:', user.role);
                sessionStorage.setItem('isLoggedIn', 'true');
                sessionStorage.setItem('currentUser', username);
                sessionStorage.setItem('userRole', user.role);
                
                // Mantener compatibilidad con el sistema anterior para admins
                if (user.role === 'admin') {
                    sessionStorage.setItem('isAdmin', 'true');
                    sessionStorage.setItem('adminUser', username);
                }
                
                hideLoginModal();
                updateUIBasedOnAuth();
                alert(`¡Bienvenido! Has iniciado sesión como ${getRoleDisplay(user.role)}.`);
            } else {
                // Login fallido
                console.log('Login fallido para usuario:', username);
                errorDiv.style.display = 'block';
                setTimeout(() => {
                    errorDiv.style.display = 'none';
                }, 3000);
                document.getElementById('password').value = '';
            }
        });

        // Hacer funciones globales
        window.showLoginModal = showLoginModal;
        window.logout = logout;
    </script>

    <style>
        /* Barra de usuario */
        .user-bar {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .user-info, .login-info {
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 15px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .login-btn, .logout-btn {
            background: #368dff;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .logout-btn {
            background: #dc3545;
        }

        .login-btn:hover {
            background: #2979ff;
        }

        .logout-btn:hover {
            background: #c82333;
        }

        /* Modal */
        .modal {
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
            position: relative;
        }

        .close {
            position: absolute;
            right: 15px;
            top: 15px;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .close:hover {
            color: #333;
        }

        #loginForm {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 1rem;
        }

        #loginForm input {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
        }

        #loginForm input:focus {
            outline: none;
            border-color: #368dff;
        }

        #loginForm button {
            background: #368dff;
            color: white;
            padding: 12px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
        }

        #loginForm button:hover {
            background: #2979ff;
        }

        .error-message {
            color: #dc3545;
            text-align: center;
            margin-top: 1rem;
            font-size: 14px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .user-bar {
                position: relative;
                top: 0;
                right: 0;
                text-align: center;
                padding: 10px;
            }
        }
    </style>
</body>

</html>